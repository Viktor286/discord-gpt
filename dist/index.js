"use strict";var A=Object.create;var b=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,B=Object.prototype.hasOwnProperty;var C=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var G=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of T(t))!B.call(e,r)&&r!==n&&b(e,r,{get:()=>t[r],enumerable:!(s=$(t,r))||s.enumerable});return e};var g=(e,t,n)=>(n=e!=null?A(N(e)):{},G(t||!e||!e.__esModule?b(n,"default",{value:e,enumerable:!0}):n,e));var I=C((X,H)=>{H.exports={name:"dotenv",version:"16.0.3",description:"Loads environment variables from .env file",main:"lib/main.js",types:"lib/main.d.ts",exports:{".":{require:"./lib/main.js",types:"./lib/main.d.ts",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},scripts:{"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard","lint-readme":"standard-markdown",pretest:"npm run lint && npm run dts-check",test:"tap tests/*.js --100 -Rspec",prerelease:"npm test",release:"standard-version"},repository:{type:"git",url:"git://github.com/motdotla/dotenv.git"},keywords:["dotenv","env",".env","environment","variables","config","settings"],readmeFilename:"README.md",license:"BSD-2-Clause",devDependencies:{"@types/node":"^17.0.9",decache:"^4.6.1",dtslint:"^3.7.0",sinon:"^12.0.1",standard:"^16.0.4","standard-markdown":"^7.1.0","standard-version":"^9.3.2",tap:"^15.1.6",tar:"^6.1.11",typescript:"^4.5.4"},engines:{node:">=12"}}});var u=C((Z,p)=>{var J=require("fs"),j=require("path"),U=require("os"),K=I(),L=K.version,F=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function Y(e){let t={},n=e.toString();n=n.replace(/\r\n?/mg,`
`);let s;for(;(s=F.exec(n))!=null;){let r=s[1],o=s[2]||"";o=o.trim();let a=o[0];o=o.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),a==='"'&&(o=o.replace(/\\n/g,`
`),o=o.replace(/\\r/g,"\r")),t[r]=o}return t}function m(e){console.log(`[dotenv@${L}][DEBUG] ${e}`)}function W(e){return e[0]==="~"?j.join(U.homedir(),e.slice(1)):e}function Q(e){let t=j.resolve(process.cwd(),".env"),n="utf8",s=!!(e&&e.debug),r=!!(e&&e.override);e&&(e.path!=null&&(t=W(e.path)),e.encoding!=null&&(n=e.encoding));try{let o=l.parse(J.readFileSync(t,{encoding:n}));return Object.keys(o).forEach(function(a){Object.prototype.hasOwnProperty.call(process.env,a)?(r===!0&&(process.env[a]=o[a]),s&&m(r===!0?`"${a}" is already defined in \`process.env\` and WAS overwritten`:`"${a}" is already defined in \`process.env\` and was NOT overwritten`)):process.env[a]=o[a]}),{parsed:o}}catch(o){return s&&m(`Failed to load ${t} ${o.message}`),{error:o}}}var l={config:Q,parse:Y};p.exports.config=l.config;p.exports.parse=l.parse;p.exports=l});var i=require("discord.js");var O=g(u());O.default.config();var{DISCORD_TOKEN:R,DISCORD_CLIENT_ID:x,OPENAI_API_KEY:E}=process.env;if(!R||!x||!E)throw new Error("Missing environment variables");var P={DISCORD_TOKEN:R,DISCORD_CLIENT_ID:x,OPENAI_API_KEY:E};function f(e,t={}){return{messages:e?[...e]:[{role:"system",content:"You are an AI assistant that helps people find information."},{role:"user",content:"marco!"}],model:"gpt-4",max_tokens:1800,temperature:.7,frequency_penalty:.1,presence_penalty:.3,top_p:.95,stop:null,...t}}var _=g(u());_.config();function h(e){return{hostname:"api.openai.com",path:"/v1/chat/completions",method:"POST",headers:{"Content-Type":"application/json","Content-Length":e.length,authorization:`Bearer ${process.env.OPENAI_API_KEY}`}}}var S=g(require("https"));async function v(e,t){return new Promise((n,s)=>{let r=S.request(e,o=>{let a="";o.on("data",c=>{a+=c}),o.on("end",()=>{n(a)})});r.on("error",o=>{console.error(o),s(o)}),r.write(t),r.end()})}async function M(e){let t=JSON.stringify(f(e)),n=h(t),s=await v(n,t);return JSON.parse(s).choices[0].message.content}function z(e,t){let n=[],s=0;for(;s<e.length;){let r=s+t;for(;e[r]&&e[r]!==" "&&e[r]!==`
`&&r>s;)r--;r===s&&(r=s+t);let o=e.slice(s,r);n.push(o),s=r+1}return n}async function y(e,t){console.log("Sending multiMessage started from: ",t.slice(0,20));let n=z(t,1900);for(let s=0;s<n.length;s++)await e.send(`'''${n[s]}`);console.log("MultiMessage successfully sent")}var d=(e,t,n)=>{e.reactions.removeAll(),e.react("\u{1F6A7}"),console.error(`Bot message thrown an error | ${t}`,n)};var q=e=>async t=>{if(t.content&&t.content.startsWith("!")){await t.react("\u23F3");try{if(t.channelId){let n=e.channels.cache.get(t.channelId);if(n&&!n.isThread())try{let s=await n.messages.fetch(n.lastMessageId),r=await n.threads.create({name:t.content.slice(0,20),autoArchiveDuration:60,startMessage:s});console.log("thread created for ",t.content.slice(0,20));let o=await r.fetch(),a=await M([{role:"user",content:t.content.slice(1)}]);await y(o,a),t.reactions.removeAll();return}catch(s){d(t,"Start new thread",s)}if(n&&n.isThread())try{let r=(await n.messages.fetch({limit:20,cache:!0})).map(({author:{username:c},content:w})=>({role:c==="lmm-gpt"?"assistant":"user",content:c==="lmm-gpt"?w.replace("\u2019","'"):w.slice(1).replace("\u2019","'")})).reverse();console.log("Captured chat based on threadMessages ",r.length);let o=await n.fetchStarterMessage();r[0]={role:"user",content:o.content.slice(1)};let a=await M(r);await y(n,a),t.reactions.removeAll();return}catch(s){d(t,"Continue existed thread",s)}}}catch(n){d(t,"obtain message",n)}}};var D=async(e,t)=>{if(e.partial)try{await e.fetch()}catch(n){console.error("Something went wrong when fetching the message:",n);return}e._emoji.name.includes("\u{1F5D1}")&&e.message.delete()};var k=()=>{let e=new i.Client({intents:[i.GatewayIntentBits.Guilds,i.GatewayIntentBits.GuildMessages,i.GatewayIntentBits.GuildMessageReactions,i.GatewayIntentBits.MessageContent],partials:[i.Partials.Message,i.Partials.Channel,i.Partials.Reaction]});return e.once("ready",async()=>{console.log("Discord bot is ready! \u{1F916}")}),e.on("guildCreate",async t=>{}),e.on(i.Events.MessageCreate,q(e)),e.on(i.Events.MessageCreate,t=>{}),e.on(i.Events.MessageReactionAdd,D),e.login(P.DISCORD_TOKEN),e};k();
